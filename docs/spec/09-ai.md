# Feature: AI Card Generation

## Overview

Two AI features assist with card creation: OCR (extract text from an image) and Card Generation (create `{ front, back }` card pairs from text or image input).

## Routes

| Path | Description |
|------|-------------|
| `/decks/[id]/ai` | AI card generation UI for a deck |

## API Endpoints

| Method | Path | Auth | Description |
|--------|------|------|-------------|
| POST | `/api/ai/ocr` | None | Extract text from an image |
| POST | `/api/ai/generate` | None | Generate cards from text or image |

Both endpoints accept `multipart/form-data`.

## OCR

**Input:**
```
POST /api/ai/ocr
Content-Type: multipart/form-data

image: <File>
```

**Output:**
```json
{ "text": "extracted text string" }
```

**AI Model:** Deepseek Vision

**Error Cases:**
| Status | Condition |
|--------|-----------|
| 400 | No image provided |
| 500 | OCR model failed |

## Card Generation

**Input:**
```
POST /api/ai/generate
Content-Type: multipart/form-data

text: "optional text input"
image: <File> (optional)
helperPrompt: "optional context or instructions"
```

At least one of `text` or `image` must be provided.

**Output:**
```json
{
  "cards": [
    { "front": "question or term", "back": "answer or definition" }
  ]
}
```

**AI Model:** OpenAI (primary)

**Error Cases:**
| Status | Condition |
|--------|-----------|
| 400 | Neither text nor image provided |
| 422 | Could not extract text from image (unclear image) |
| 500 | Card generation failed (check API key) |

## AI Providers

| Provider | Used For | SDK |
|----------|----------|-----|
| OpenAI | Card generation | `@ai-sdk/openai` |
| Deepseek (Vision) | OCR | `@ai-sdk/deepseek` |

Configuration: `src/lib/ai.ts`
Environment variables: `OPENAI_API_KEY`, `DEEPSEEK_API_KEY`

## Typical Flow (UI)

1. User navigates to `/decks/[id]/ai`
2. User uploads image or pastes text
3. Optional: add `helperPrompt` for context (e.g., "These are Chinese vocabulary words")
4. User submits â†’ AI returns card array
5. User reviews generated cards and selects which to add
6. Selected cards are saved via `POST /api/decks/[id]/cards`

## Acceptance Criteria

- [ ] User can upload an image for OCR text extraction
- [ ] Extracted text is pre-filled into the generation input
- [ ] User can provide plain text (without image) to generate cards
- [ ] AI returns structured `{ front, back }` card array
- [ ] User can review and selectively add generated cards to the deck
- [ ] Clear error messages for: no input, unclear image, missing API key
- [ ] `helperPrompt` field allows user to add generation context
